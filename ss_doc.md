# Attendance Screenshot API (`/api/v1/attendance/screenshot`)

This API returns a PNG screenshot of the attendance/calendar widget only (`#calendar`, fallback `#calendarMain`).

## Endpoint

- Method: `GET`
- URL: `/api/v1/attendance/screenshot`
- Auth: HTTP Basic Auth (same Amizone username/password used for other APIs)

## Success Response

- Status: `200 OK`
- Content-Type: `image/png`
- Body: raw PNG bytes

## Rate Limit

- Limit: `1 successful screenshot / user / 10 minutes`
- If blocked:
  - Status: `429 Too Many Requests`
  - Header: `Retry-After: <seconds>`
  - Body:

```json
{
  "error": "screenshot is rate limited for this user",
  "retry_after_seconds": 412
}
```

## Error Responses

- `401 Unauthorized`: missing/invalid Basic Auth credentials
- `405 Method Not Allowed`: method is not `GET`
- `502 Bad Gateway`: screenshot service/browser automation failed

## cURL Example

```bash
curl -u "ENROLLMENT:PASSWORD" \
  -X GET "http://localhost:8080/api/v1/attendance/screenshot" \
  --output attendance.png
```

## JavaScript Example

```js
const username = "ENROLLMENT";
const password = "PASSWORD";

const basic = btoa(`${username}:${password}`);
const res = await fetch("http://localhost:8080/api/v1/attendance/screenshot", {
  method: "GET",
  headers: {
    Authorization: `Basic ${basic}`,
  },
});

if (res.status === 429) {
  const body = await res.json();
  throw new Error(`Rate limited. Retry after ${body.retry_after_seconds}s`);
}

if (!res.ok) {
  const body = await res.json().catch(() => ({}));
  throw new Error(body.error || `Request failed: ${res.status}`);
}

const blob = await res.blob();
// Use blob as needed (download/show/upload)
```

## Notes

- The screenshot is generated by the browser-login service and proxied by the Go backend.
- The Go backend enforces the 10-minute per-user rate limit.
- The response uses `Cache-Control: no-store`.
